@{
    ViewBag.Title = "frmNarcoticLicenseRpt";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="~/AdminLTE/plugins/jQuery/jquery-2.2.3.min.js"></script>
<link href="~/Content/CSS/InputText.css" rel="stylesheet" />
<div class="box-header with-border">
    <div class="row">
        <div class="col-md-4"><div id="MessageText"></div></div>
        <div class="col-md-8">
            <div style="text-align:right;">
                <button id="btnView" class="btn btn-primary btn-lg" type="submit"><i class="glyphicon glyphicon-file"></i>view</button>
                <button id="btnReset" class="btn btn-primary btn-lg" type="button"><i class="glyphicon glyphicon-refresh"></i>Reset</button>
            </div>
        </div>
    </div>
</div>
<div class="box-body">
    <div class="row">
        <div class="col-md-2">
            <div class="form-group">
                <label class="control-label required">Company:</label>
                <select id="CompanyCode" name="CompanyCode" class="form-control input-sm">
                    <option selected value="All">All</option>
                    <option value="0001">SPPLC (Pabna Unit)</option>
                    <option value="0002">SPPLC (Dhaka Unit)</option>
                    <option value="0004">SPPLC (CD)</option>
                    <option value="0005">SPPLC (Herbal)</option>
                    <option value="0006">SPPLC (Ayurvedic)</option>
                    <option value="0007">SLL</option>
                </select>
            </div>
        </div>
        <div class="col-md-2">
            <div class="form-group">
                <label class="control-label required">Item Name:</label>
                <select id="GenericCode" name="GenericCode" class="form-control input-sm">
                    <option selected value="All">All</option>
                    <option value="Recipe Approval">Individual</option>
                </select>

            </div>
        </div>
        <div class="col-md-2">
            <div class="form-group">
                <label class="control-label required">Type:</label>
                <select id="SubmissionType" name="SubmissionType" class="form-control input-sm">
                    <option selected value="All">All</option>
                    <option value="Import Permit">Import Permission</option>
                    <option value="Export">Export</option>
                    <option value="Quota Increase">Quota Increase</option>
                    <option value="New license">New license</option>
                    <option value="Quota allocation & Endorsement">Annual Quota allocation & Endorsement</option>
                    <option value="Endorsement">Endorsement</option>
                    <option value="NOC">NOC</option>
                    <option value="Others">Others</option>
                </select>

            </div>
        </div>

        <div class="col-md-2">
            <div class="form-group">
                <label class="control-label required">Fiscal Year:</label>
                <select id="FiscalYear" name="FiscalYear" class="form-control input-sm">
                    <option selected value="All">All</option>
                    <option value="2024-2025">2024-2025</option>
                    <option value="2023-2024">2023-2024</option>
                    <option value="2022-2023">2022-2023</option>
                    <option value="2021-2022">2021-2022</option>
                    <option value="2020-2021">2020-2021</option>
                </select>
            </div>
        </div>
        <div class="col-md-2">
            <div class="form-group">
                <label class="control-label required">Record Status:</label>
                <select id="RecordStatus" name="RecordStatus" class="form-control input-sm">
                    <option selected value="All">All</option>
                    <option value="License">License</option>
                    <option value="Renew">Renew</option>

                </select>
            </div>
        </div>
    </div>




</div>

<div class="row">
    <div class="col-md-12">
        <div id="MainGrid" class="PopUpGrid"></div>
    </div>
</div>



<div class="box-footer">@*Form Footer*@</div>

<script type="text/javascript">


    $(document).ready(function () {

        function ResetData() {
            // Reset all your dropdowns to "All"
            $('#CompanyCode').val('All');
            $('#GenericCode').val('All');
            $('#SubmissionType').val('All');
            $('#FiscalYear').val('All');
            $('#RecordStatus').val('All');

            // Reset any text inputs if you have them
            $('#CompanyName').val('');
            $('#Address').val('');

            // Clear Kendo Grid data
            var grid = $("#MainGrid").data("kendoGrid");
            if (grid) {
                grid.dataSource.data([]);
            }
        }

        // Attach the click event
        $('#btnReset').click(function () {
            ResetData();
        });


        $('.input-group.date').datepicker({
            format: "d/mm/yyyy",//dd M yyyy
            autoclose: true,
            todayHighlight: true
            //,todayBtn: true,
        });
        var MainGrid = $('#MainGrid').kendoGrid({
            dataSource: new kendo.data.DataSource({
                batch: true,
                schema: {
                    model: {
                        id: "ID",
                        fields: {
                            ID: { type: "string" },
                            // Specify all your date fields here as type date:
                            DgdaSubmissionDate: { type: "date" },
                            DgdaRecommendationDate: { type: "date" },
                            InsReceiveDate: { type: "date" },
                            DivNarcRecvDate: { type: "date" },
                            DncSendDate: { type: "date" },
                            NarcApvlDate: { type: "date" },

                            // Also any other dates you want to parse/display properly:
                            DgdaReceiveDate: { type: "date" },
                            RecSendDate: { type: "date" },
                            DivSendDate: { type: "date" },
                            SetOn: { type: "date" },
                            UpdatedDate: { type: "date" }
                        }
                    }
                },
                pageSize: 20,
            }),
            pageable: {
                //refresh: true,
                pageSizes: true, buttonCount: 5
            },
            scrollable: true,
            sortable: true,
            filterable: true,
            editable: false,
            selectable: "row",
            //selectable: "multiple",
            toolbar: ["excel", { template: "<input type='text' id='txtPopupInput'  style='float:right' placeholder='Search...' class='k-textbox'>" }, ],
            excel: {
                fileName: "Export.xlsx",
                allPages: true,
                filterable: true
            },
            navigatable: true,
            height: "400",
            // groupable: true,
            groupable: { messages: { empty: "Custom message text" } },
            columnMenu: true,
            reorderable: true,
            resizable: true,
            columns: [
                 { field: "ID", hidden: true },

                 { field: "CompanyCode", title: "Code", width: 70, hidden: true },
                 { field: "CompanyName", title: "CompanyName", width: 140 },
                 { field: "ItemName", title: "ItemName", width: 100 },
                 { field: "SubmissionType", title: "SubmissionType", width: 120 },
                 { field: "AnnualQuota", title: "AnnualQuota", width: 100, hidden: false },
                 { field: "SubmissionQuantity", title: "SubmissionQuantity", width: 100, hidden: false },
                 // Here you can add format for date columns:
        {
            field: "DgdaSubmissionDate",
            title: "Date of Submission to DGDA",
            width: 120,
            format: "{0:dd.MM.yyyy}",
            type: "date"
        },

        {
            field: "DgdaRecommendationDate",
            title: "DGDA recommendation approval Date",
            width: 100,
            format: "{0:dd.MM.yyyy}",
            type: "date"
        },
        {
            field: "InsReceiveDate",
            title: "Inspection report received from DNC Local office",
            width: 100,
            format: "{0:dd.MM.yyyy}",
            type: "date"
        },

        {
            field: "DivNarcRecvDate",
            title: "Inspection report received from DNC Divisional office",
            width: 120,
            format: "{0:dd.MM.yyyy}",
            type: "date"
        },

        {
            field: "DncSendDate",
            title: "Date of Submission to DNC Head Office",
            width: 100,
            hidden: true,
            format: "{0:dd.MM.yyyy}",
            type: "date"
        },

        {
            field: "NarcApvlDate",
            title: "DNC Approval Date",
            width: 120,
            format: "{0:dd.MM.yyyy}",
            type: "date"
        },
                 { field: "ApprovedQuantity", title: "ApprovedQuantity", width: 100 },


                 { field: "REMARKS", title: "REMARKS", width: 120 },

            ]

        }).data('kendoGrid');

        function parseNetDate(dateString) {
            if (!dateString) return null;
            var match = /\/Date\((\d+)(?:-\d+)?\)\//.exec(dateString);
            return match ? new Date(parseInt(match[1])) : null;
        }

        $('#btnView').click(function () {
            debugger
            var model = {};
            model.CompanyCode = $('#CompanyCode').val();
            model.GenericCode = $('#GenericCode').val();
            model.SubmissionType = $('#SubmissionType').val();
            model.FiscalYear = $('#FiscalYear').val();
            model.RecordStatus = $('#RecordStatus').val();
            $.ajax({
                url: '@Url.Action("GetReportNarcoticLicense", "NarcoticLicense")',
                data: JSON.stringify(model),
                type: 'POST',
                contentType: 'application/json;',
                dataType: 'json',
                success: function (data) {debugger
                    if (data && data.length > 0) {
                        // Map each item and convert date fields
                        var processedData = data.map(function(item) {debugger
                            return {
                                ...item,
                                    DgdaSubmissionDate: parseNetDate(item.DgdaSubmissionDate),
                                DgdaRecommendationDate: parseNetDate(item.DgdaRecommendationDate),
                            InsReceiveDate: parseNetDate(item.InsReceiveDate),
                            DivNarcRecvDate: parseNetDate(item.DivNarcRecvDate),
                            DncSendDate: parseNetDate(item.DncSendDate),
                            NarcApvlDate: parseNetDate(item.NarcApvlDate),
                            DgdaReceiveDate: parseNetDate(item.DgdaReceiveDate),
                            RecSendDate: parseNetDate(item.RecSendDate),
                            DivSendDate: parseNetDate(item.DivSendDate),
                            SetOn: parseNetDate(item.SetOn),
                            UpdatedDate: parseNetDate(item.UpdatedDate)
                            // Add other date fields if you want
                        };
                    });

                    $('#MainGrid').data('kendoGrid').dataSource.data(processedData);
                } else {
                  $('#MainGrid').data('kendoGrid').dataSource.data([]);
        AcknowledgeMsg();
        }
        }
            });

        });


    });

</script>




